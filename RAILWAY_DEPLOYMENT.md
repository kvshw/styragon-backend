# Railway Deployment Guide for Styragon CMS

## Overview
This guide will help you deploy the Django backend to Railway and connect it with your Vercel frontend.

## Architecture
- **Primary Database**: Railway PostgreSQL
- **Content Management**: Django Admin Panel
- **Data Sync**: Optional Supabase sync for initial content
- **Frontend**: Vercel (Next.js)

## Railway Deployment Steps

### 1. Create Railway Project
1. Go to [Railway.app](https://railway.app)
2. Create new project
3. Connect your GitHub repository
4. Select the `backend` folder as the root directory

### 2. Add PostgreSQL Database
1. In Railway dashboard, click "New"
2. Select "Database" → "PostgreSQL"
3. Railway will automatically create a `DATABASE_URL` environment variable

### 3. Configure Environment Variables
Set these in Railway dashboard → Variables:

```env
# Django Settings
SECRET_KEY=your-super-secret-key-here
DEBUG=False
ALLOWED_HOSTS=your-app-name.up.railway.app

# Database (auto-generated by Railway)
DATABASE_URL=postgresql://postgres:password@host:port/railway

# Supabase (for initial data sync)
SUPABASE_URL=https://wgryzcdwebjbmkadrerh.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_KEY=your-service-key

# CORS Settings
CORS_ALLOWED_ORIGINS=https://your-vercel-app.vercel.app
CSRF_TRUSTED_ORIGINS=https://your-app-name.up.railway.app,https://your-vercel-app.vercel.app
```

### 4. Deploy
1. Railway will automatically detect the `Procfile`
2. The deployment will run migrations and collect static files
3. Your API will be available at `https://your-app-name.up.railway.app/api/`
4. Admin panel at `https://your-app-name.up.railway.app/admin/`

## Vercel Frontend Configuration

### 1. Environment Variables
In Vercel dashboard → Settings → Environment Variables:

```env
NEXT_PUBLIC_API_URL=https://your-app-name.up.railway.app/api
```

### 2. Deploy
1. Connect your GitHub repository to Vercel
2. Select the `frontend` folder as root
3. Deploy

## Content Management Workflow

### Option 1: Django Admin Only (Recommended)
1. Use Django Admin at `https://your-app-name.up.railway.app/admin/`
2. Create superuser: `python manage.py createsuperuser`
3. Manage all content through Django Admin
4. Frontend fetches data via REST API

### Option 2: Supabase + Django Sync
1. Manage content in Supabase dashboard
2. Run sync command: `python manage.py sync_supabase`
3. Django Admin shows synced content
4. Frontend uses Django API

## Database Management

### Local Development
```bash
# Use SQLite for local development
unset DATABASE_URL
python manage.py migrate
python manage.py runserver
```

### Production (Railway)
- Railway PostgreSQL is your primary database
- Django Admin manages all content
- Optional: Sync from Supabase for initial data

## API Endpoints
- API Root: `https://your-app-name.up.railway.app/api/`
- Admin Panel: `https://your-app-name.up.railway.app/admin/`
- Blog Posts: `https://your-app-name.up.railway.app/api/blog-posts/`
- Projects: `https://your-app-name.up.railway.app/api/projects/`
- Services: `https://your-app-name.up.railway.app/api/services/`
- Testimonials: `https://your-app-name.up.railway.app/api/testimonials/`

## Troubleshooting

### Common Issues
1. **CORS Errors**: Check `CORS_ALLOWED_ORIGINS` includes your Vercel domain
2. **Database Connection**: Verify `DATABASE_URL` is set correctly
3. **Static Files**: Ensure `collectstatic` runs during deployment
4. **Admin Access**: Create superuser via Railway console

### Railway Console Commands
```bash
# Create superuser
python manage.py createsuperuser

# Run migrations
python manage.py migrate

# Sync from Supabase
python manage.py sync_supabase

# Collect static files
python manage.py collectstatic --noinput
```

## Security Notes
- Never commit `.env` files
- Use strong `SECRET_KEY` in production
- Set `DEBUG=False` in production
- Configure proper `ALLOWED_HOSTS`
- Use HTTPS in production (Railway provides this automatically)

## Monitoring
- Railway provides built-in monitoring
- Check logs in Railway dashboard
- Monitor database usage
- Set up alerts for downtime

